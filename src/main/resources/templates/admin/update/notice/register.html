<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Notice Register</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/admin/global_admin.css}" />
    <!-- editor -->
    <link rel="stylesheet"
          href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
</head>
<body>
<div class="admin-layout">
    <th:block th:replace="admin/fragments/sidebar :: adminSidebar('noticeRegister')"/>

    <main class="admin-content d-flex flex-column">
        <div class="container mt-5 flex-grow-1">
            <h2 class="mb-4 fw-bold">Notice Register</h2>

            <form id="noticeRegistForm"
                  th:action="@{/admin/update/notices/register}"
                  th:object="${request}"
                  method="post"
                  enctype="multipart/form-data"
                  class="card p-4 shadow-sm">

                <div class="mb-3">
                    <label class="form-label fw-semibold">제목</label>
                    <input type="text"
                           class="form-control"
                           th:field="*{title}"
                           placeholder="제목을 입력하세요" />
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">카테고리</label>
                    <select class="form-select" th:field="*{category}">
                        <option value="">선택</option>
                        <option th:each="cat : ${categories}"
                                th:value="${cat}"
                                th:text="${cat}">
                        </option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">내용</label>
                    <div id="editor"></div>
                    <input type="hidden" name="content" id="content">
                </div>

                <div class="mb-4">
                    <label class="form-label fw-semibold">첨부파일</label>
                    <input type="file"
                           class="form-control"
                           th:field="*{files}"
                           multiple />
                </div>

                <div class="d-flex justify-content-end gap-2">
                    <a th:href="@{/admin/update/notices/list}"
                       class="btn btn-outline-secondary">
                        취소
                    </a>
                    <button type="submit"
                            class="btn btn-primary">
                        등록
                    </button>
                </div>

            </form>
        </div>
    </main>

</div>

<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
<script>
    const editor = new toastui.Editor({
        el: document.querySelector('#editor'),
        height: '400px',
        initialEditType: 'wysiwyg',
        previewStyle: 'vertical',

        hooks: {
            addImageBlobHook: (blob, callback) => {
                const formData = new FormData();
                formData.append('image', blob);

                fetch('/admin/update/notices/image', {
                    method: 'POST',
                    body: formData
                })
                .then(res => res.json())
                .then(data => {
                    callback(data.url, data.alt);
                })
                .catch(err => {
                    console.error(err);
                });
            }
        }
    });

    // submit 시 content 채우기
    document.getElementById('noticeRegistForm').addEventListener('submit', function () {
        document.getElementById('content').value = editor.getHTML();
    });
</script>

</body>
</html>