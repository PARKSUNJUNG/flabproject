<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>카테고리 목록</title>

    <!-- Bootstrap -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

    <!-- Custom CSS (선택) -->
    <link rel="stylesheet" th:href="@{/css/admin/global_admin.css}" />
</head>
<body class="container py-5">
<th:block th:replace="admin/fragments/sidebar :: adminSidebar('category')"/>

<main class="admin-content">
    <div class="container py-5">
        <h2 class="fw-bold mb-4">카테고리 관리</h2>

        <!-- 상단 버튼 영역 -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="text-muted">총 <strong th:text="${#lists.size(categories)}"></strong> 개</span>
            <a th:href="@{/admin/product/category/register}" class="btn btn-primary">카테고리 등록</a>
        </div>

        <!-- 카테고리 테이블 -->
        <div class="card">
            <div class="card-body p-0">
                <table class="table table-hover mb-0 align-middle">
                    <thead class="table-light">
                    <tr>
                        <th style="width: 80px">번호</th>
                        <th>카테고리명</th>
                        <th style="width: 180px">관리</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${#lists.isEmpty(categories)}">
                        <td colspan="3" class="text-center py-4 text-muted">등록된 카테고리가 없습니다.</td>
                    </tr>

                    <tr th:each="category, iter : ${categories}">
                        <td th:text="${iter.index + 1}"></td>
                        <td th:text="${category.name}"></td>
                        <td>
                            <div class="d-flex gap-2">
                                <button type="button"
                                        class="btn btn-outline-secondary btn-sm"
                                        th:data-id="${category.id}"
                                        th:data-name="${category.name}"
                                        onclick="editCategory(this)">
                                    수정
                                </button>
                                <button type="button"
                                        class="btn btn-outline-danger btn-sm"
                                        th:onclick="|deleteCategory(${category.id})|">
                                    삭제
                                </button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 수정 모달 -->
        <div class="modal fade" id="editModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">카테고리 수정</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="editId">
                        <div class="mb-3">
                            <label class="form-label">카테고리명</label>
                            <input type="text" id="editName" class="form-control">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                        <button type="button" class="btn btn-primary" onclick="updateCategory()">저장</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const modal = new bootstrap.Modal(document.getElementById('editModal'));

    function editCategory(btn) {
        const id = btn.dataset.id;
        const name = btn.dataset.name;

        document.getElementById('editId').value = id;
        document.getElementById('editName').value = name;
        modal.show();
    }

    async function updateCategory() {
        const id = document.getElementById('editId').value;
        const name = document.getElementById('editName').value.trim();
        if (!name) return alert('카테고리명을 입력하세요');

        await fetch(`/admin/categories/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name })
        });

        location.reload();
    }

    async function deleteCategory(id) {
        if (!confirm('정말 삭제하시겠습니까?')) return;

        await fetch(`/admin/categories/${id}`, { method: 'DELETE' });
        location.reload();
    }
</script>

</body>
</html>