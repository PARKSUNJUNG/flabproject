<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>굿즈 목록</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/admin/global_admin.css}" />
    <link th:href="@{/css/admin/product/list.css}" rel="stylesheet">
</head>
<body>
<th:block th:replace="admin/fragments/sidebar :: adminSidebar('product')"/>

<main class="admin-content">
    <div class="container mt-5">

        <!-- 제목 + 등록 버튼 -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="fw-bold">상품 목록</h2>
            <a th:href="@{/admin/product/register}" class="btn btn-primary">
                상품 등록
            </a>
        </div>

        <!-- 상품 테이블 -->
        <div class="table-responsive">
            <table class="table table-hover align-middle product-table">
                <thead class="table-light">
                <tr>
                    <th>#</th>
                    <th>상품명</th>
                    <th>카테고리</th>
                    <th>가격</th>
                    <th>재고</th>
                    <th>상태</th>
                    <th class="text-center">관리</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="product, iter : ${products}">
                    <td th:text="${iter.index + 1}"></td>

                    <td>
                        <a th:href="@{/admin/product/{id}(id=${product.id})}"
                           class="product-name">
                            <span th:text="${product.productName}"></span>
                        </a>
                    </td>

                    <td th:text="${product.categoryName}"></td>

                    <td>
                        <span th:text="${#numbers.formatInteger(product.price, 0, 'COMMA')}"></span> 원
                    </td>

                    <td th:text="${product.totalStock}"></td>

                    <td>
                        <span th:if="${product.totalStock > 0}" class="badge bg-success">
                            판매중
                        </span>
                        <span th:if="${product.totalStock == 0}" class="badge bg-secondary">
                            품절
                        </span>
                    </td>

                    <td class="text-center">
                        <a th:href="@{/admin/product/{id}/edit(id=${product.id})}"
                           class="btn btn-sm btn-outline-secondary">
                            수정
                        </a>

                        <button class="btn btn-sm btn-outline-danger"
                                th:onclick="|deleteProduct(${product.id})|">
                            삭제
                        </button>
                    </td>
                </tr>

                <!-- 데이터 없을 때 -->
                <tr th:if="${#lists.isEmpty(products)}">
                    <td colspan="7" class="text-center text-muted py-5">
                        등록된 상품이 없습니다.
                    </td>
                </tr>

                </tbody>
            </table>
        </div>
    </div>
</main>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    function deleteProduct(id) {
        if (!confirm("정말 삭제하시겠습니까?")) return;

        fetch(`/admin/product/${id}/delete`, {
            method: "POST"
        }).then(res => {
            if (res.ok) {
                location.reload();
            } else {
                alert("삭제 실패");
            }
        });
    }
</script>

</body>
</html>
