<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>주문하기</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/user/global.css}" />
</head>

<body>
<div th:replace="user/fragments/header :: header"></div>

<main>
    <div class="container my-5">
        <div class="row g-4">

            <!-- 좌측: 주문 상품 정보 -->
            <div class="col-md-6">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title mb-3">주문 상품</h5>

                        <p class="fw-bold mb-1" th:text="${order.productName}">
                            상품명
                        </p>
                        <p class="text-muted mb-3">
                            가격:
                            <span id="basePrice" th:text="${order.price}">0</span> 원
                        </p>

                        <!-- 옵션 상품 -->
                        <div th:if="${order.useOption}">
                            <h6 class="mb-2">선택한 옵션</h6>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item px-0"
                                    th:each="opt : ${order.selectedOptions}">
                                    <div class="d-flex justify-content-between">
                                        <span th:text="${opt.optionCombination}">
                                            옵션명
                                        </span>
                                        <span class="text-muted">
                                            수량:
                                            <span th:text="${opt.quantity}">1</span> 개
                                        </span>
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <!-- 단일 상품 -->
                        <div th:if="${!order.useOption}">
                            <h6 class="mb-2">수량</h6>
                            <p>
                                <span th:text="${order.quantity}">1</span> 개
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 배송 정보 -->
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title mb-4">배송 정보</h5>

                    <form id="orderForm" th:action="@{/orders}" method="post">

                        <input type="hidden" name="productId" th:value="${order.productId}">
                        <div th:each="opt, stat : ${order.selectedOptions}">
                            <input type="hidden"
                                   th:name="|options[${stat.index}].optionStockId|"
                                   th:value="${opt.optionStockId}"/>

                            <input type="hidden"
                                   th:name="|options[${stat.index}].quantity|"
                                   th:value="${opt.quantity}"/>
                        </div>
                        <input type="hidden" name="quantity" th:value="${order.quantity}">

                        <!-- 주문자 정보 -->
                        <h6 class="mb-3">주문자 정보</h6>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">주문자명</label>
                                <input type="text"
                                       class="form-control"
                                       name="ordererName"
                                       th:value="${order.ordererName}"
                                       readonly>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">연락처</label>
                                <input type="text"
                                       class="form-control"
                                       name="ordererPhone"
                                       th:value="${order.ordererPhone}"
                                       readonly>
                            </div>
                        </div>

                        <hr>

                        <!-- 수령인 정보 -->
                        <h6 class="mb-3">수령인 정보</h6>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">수령인명</label>
                                <input type="text"
                                       class="form-control"
                                       name="receiverName"
                                       th:value="${order.receiverName}">
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">연락처</label>
                                <input type="text"
                                       class="form-control"
                                       name="receiverPhone"
                                       th:value="${order.receiverPhone}">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">주소</label>
                            <input type="text"
                                   class="form-control"
                                   name="address"
                                   th:value="${order.address}">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">상세주소</label>
                            <input type="text"
                                   class="form-control"
                                   name="addressDetail"
                                   th:value="${order.addressDetail}">
                        </div>

                    </form>
                </div>
            </div>
        </div>

        <!-- 결제 요약 -->
        <div class="card shadow-sm mt-4">
            <div class="card-body d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    총 결제 금액
                </h5>
                <h4 class="text-primary mb-0">
                    <span id="totalPrice"
                          th:text="${order.totalPrice}">0</span> 원
                </h4>
            </div>
        </div>

        <!-- 주문 버튼 -->
        <div class="d-flex justify-content-end mt-4">
            <button class="btn btn-primary btn-lg px-5"
                    onclick="submitOrder()">
                주문하기
            </button>
        </div>
    </div>
</main>

<script>
    function submitOrder() {
        document.getElementById("orderForm").submit();
    }
</script>

</body>
</html>
